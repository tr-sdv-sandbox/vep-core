// Copyright 2025 Vehicle Edge Platform Contributors
// SPDX-License-Identifier: Apache-2.0
//
// OTEL Probe - DDS IDL definitions
//
// Defines message types for OpenTelemetry metrics and logs
// received via OTLP gRPC and published to DDS.
//
// Note: Uses vss_types.idl for shared Header and KeyValue types.

#include "vss_types.idl"

module otel_telemetry {

    // ================================================================
    // PROMETHEUS-STYLE METRICS
    // ================================================================

    /**
     * Counter metric (cumulative, only increases).
     */
    struct Counter {
        string name;
        vss::types::Header header;
        sequence<vss::types::KeyValue> labels;
        double value;
    };
    #pragma keylist Counter name

    /**
     * Gauge metric (can go up or down).
     */
    struct Gauge {
        string name;
        vss::types::Header header;
        sequence<vss::types::KeyValue> labels;
        double value;
    };
    #pragma keylist Gauge name

    /**
     * Histogram bucket.
     */
    struct HistogramBucket {
        double upper_bound;
        unsigned long long cumulative_count;
    };

    /**
     * Histogram metric.
     */
    struct Histogram {
        string name;
        vss::types::Header header;
        sequence<vss::types::KeyValue> labels;
        unsigned long long sample_count;
        double sample_sum;
        sequence<HistogramBucket> buckets;
    };
    #pragma keylist Histogram name

    /**
     * Summary quantile.
     */
    struct SummaryQuantile {
        double quantile;                     // 0.5, 0.9, 0.99, etc.
        double value;
    };

    /**
     * Summary metric.
     */
    struct Summary {
        string name;
        vss::types::Header header;
        sequence<vss::types::KeyValue> labels;
        unsigned long long sample_count;
        double sample_sum;
        sequence<SummaryQuantile> quantiles;
    };
    #pragma keylist Summary name

    // ================================================================
    // LOG ENTRIES
    // ================================================================

    enum LogLevel {
        LOG_LEVEL_DEBUG,
        LOG_LEVEL_INFO,
        LOG_LEVEL_WARN,
        LOG_LEVEL_ERROR
    };

    /**
     * A log entry from OTLP logs.
     */
    struct LogEntry {
        vss::types::Header header;
        LogLevel level;
        string component;                    // Software component / service name
        string message;                      // Log message body
        sequence<vss::types::KeyValue> attributes;   // Structured attributes
        string trace_id;                     // Optional trace correlation
        string span_id;                      // Optional span correlation
    };
    #pragma keylist LogEntry

    // ================================================================
    // DIAGNOSTICS
    // ================================================================

    enum MeasurementType {
        MEASUREMENT_TYPE_ACCUMULATED,        // Cumulative (counters)
        MEASUREMENT_TYPE_MOMENTARY           // Point-in-time (gauges)
    };

    /**
     * Scalar diagnostic measurement.
     */
    struct ScalarMeasurement {
        string variable_id;
        vss::types::Header header;
        string unit;
        MeasurementType measurement_type;
        double value;
    };
    #pragma keylist ScalarMeasurement variable_id

    /**
     * Vector diagnostic measurement (histograms, distributions).
     */
    struct VectorMeasurement {
        string variable_id;
        vss::types::Header header;
        string unit;
        MeasurementType measurement_type;
        sequence<double> values;
        sequence<double> bin_boundaries;     // For histograms
        double window_duration_s;            // For sliding windows
    };
    #pragma keylist VectorMeasurement variable_id

}; // module otel_telemetry
